<!DOCTYPE html>
<html>
<head>
    <title>DotA HeatMap</title>
    <meta charset="utf-8">
  <!--  <link href=bootstrap-3.1.1-dist/css/bootstrap.css rel=stylesheet media="screen">
  -->

    <link href="http://s3.amazonaws.com/codecademy-content/courses/ltp/css/shift.css" rel="stylesheet">
    <link rel="stylesheet" href="http://s3.amazonaws.com/codecademy-content/courses/ltp/css/bootstrap.css">


</head>
<style>

    .axis text {
        font: 10px sans-serif;
    }

    .axis path,
    .axis line {
        fill: none;
        stroke: #000;
    }

</style>

<body>

<form id="filterForm">
<div class="nav">
      <div class="container">
    <fieldset>
    <table class="table table-striped">
        <tr>
            <td>
                <select id = "match">
                    <option value="648283764">Match #1</option>
                    <option value="569649581">Match #2</option>
                </select>
            </td>
            <td>
                <label>Match</label>
            </td>
        </tr>
        <tr><td><input id="p0" value="0" type="checkbox"></input></td><td><label id="lp0">Player #1</label></td></tr>
        <tr><td><input id="p1" value="1" type="checkbox"></input></td><td><label id="lp1">Player #2</label></td></tr>
        <tr><td><input id="p2" value="2" type="checkbox"></input></td><td><label id="lp2">Player #3</label></td></tr>
        <tr><td><input id="p3" value="3" type="checkbox"></input></td><td><label id="lp3">Player #4</label></td></tr>
        <tr><td><input id="p4" value="4" type="checkbox"></input></td><td><label id="lp4">Player #5</label></td></tr>
        <tr><td><input id="p5" value="5" type="checkbox"></input></td><td><label id="lp5">Player #6</label></td></tr>
        <tr><td><input id="p6" value="6" type="checkbox"></input></td><td><label id="lp6">Player #7</label></td></tr>
        <tr><td><input id="p7" value="7" type="checkbox"></input></td><td><label id="lp7">Player #8</label></td></tr>
        <tr><td><input id="p8" value="8" type="checkbox"></input></td><td><label id="lp8">Player #9</label></td></tr>
        <tr><td><input id="p9" value="9" type="checkbox"></input></td><td><label id="lp9">Player #10</label></td></tr>
    </table>
    </fieldset>

   </div>
   </div> 

</form>
<div class="row">
    <div class="col-md-4" id ="svgArea"></div>
</div>

<script src="D3/D3.js"></script>


<script>
    // Creates your margin and size of your canvas
    var margin = {top: 30, right: 30, bottom: 30, left: 30};
    var width = 600,
            height = 600;


    // In order for the margins to work we need to append a "g" (graphic) element to our svg
    var svg = d3.select("#svgArea").append("svg")
            .attr("width", width+50)
            .attr("height", height+150)
            .append("g")
            .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

    var xS = d3.scale.linear().range([0, width - margin.right]);
    var yS = d3.scale.linear().range([height - margin.bottom, 0]);


    var xAxis = d3.svg.axis()
            .scale(xS)
            .orient("bottom");

    var yAxis = d3.svg.axis()
            .scale(yS)
            .orient("left")
            //.ticks(10);

    var color = d3.scale.ordinal().range(['rgb(166,206,227)','rgb(31,120,180)','rgb(178,223,138)','rgb(51,160,44)','rgb(251,154,153)','rgb(227,26,28)','rgb(253,191,111)','rgb(255,127,0)','rgb(202,178,214)','rgb(106,61,154)','rgb(255,255,153)','rgb(177,89,40)']);

        // we add the axis
        svg.append("g")
                .attr("class", "x axis")
                .attr("transform", "translate(0," + (height - margin.bottom) + ")")
                .call(xAxis);

        svg.append("g")
                .attr("class", "y axis")
                .call(yAxis);

    var container = svg.append("g"),
        dataset;

    var updateMap = function (match, playerFilter) {
        var playerMap = {},
            players = 0;
        if (dataset) {
            dataset.remove();
        }
        var playerNodes = document.getElementById('players');
        d3.csv("data/match_"+match+".csv", function(error, data){
            //console.log(data);
            data.forEach(function(d) {
            //     //Sometimes the numbers are returned as strings, these lines transform those strings are transformed into numbers
                d.t = parseInt(d.t);
                d.x = parseInt(d.x);
                d.y = parseInt(d.y);
                d.team = parseInt(d.team);
                if (playerMap[d.player] == undefined) {
                    document.getElementById('lp' + players).innerText = d.player;
                    playerMap[d.player] = players++;
                }
             });

            //console.log(data)
            //console.log(playerMap);

            xS.domain(d3.extent(data, function(d){return d.x;})).nice();
            yS.domain(d3.extent(data, function(d){return d.y;}))   

            var filter = function (d) {
                if (playerFilter == undefined || playerFilter.length == 0) {
                    return 6;
                }
                if (playerFilter[playerMap[d.player]]) {
                    return 6;
                }
                return 0;
            };

            dataset = container.selectAll("rect")
                    .data(data)
                    .enter()
                    .append("rect")
                    .attr("x", function (d){return xS(d.x)})
                    .attr("y", function (d){return yS(d.y)})
                    .attr("width",   filter)
                    .attr("height",  filter)
                    .style("fill",   function(d){ return color(playerMap[d.player]) })

        });
    }

    updateMap('648283764', []);
    var form = document.getElementById('filterForm');
    form.onchange = function () {
        var players = [];
        var i;
        var empty = true;
        for(i = 0; i < 10; i +=1) {
            var node = document.getElementById('p' + i);
            players.push(node.checked);
            if (node.checked) {
                empty = false;
            }
        }
        updateMap(form.match.value, empty ? undefined : players);
    }
</script>
</body>
</html>